---
title: "Analysis Package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Vignette
```{r setup, echo=FALSE, results='hide'}
### Call Library
library(tidyverse)
### using source for now
source("C:/Users/19164/Downloads/-141C-Project-Yiqi-ren/-141C-Project-Yiqi-ren/vignettes/analysis.R")
```
```{r, echo=FALSE}
### Read in data Set

df <- read.csv("C:/Users/19164/Downloads/-141C-Project-Yiqi-ren/-141C-Project-Yiqi-ren/vignettes/adult.csv")
df$income <- ifelse(df$income ==">50K",1,0)
vignette_sample <- df[1:250,]

```

# split_data 
Use'split_data'  to split data into m subsamples.
Here vignette sample is being spit into 10 subsets.
```{r}
m = 10
boots <- split_data(vignette_sample, m)

```

# glm_each_boot
Use 'glm_each_boot' to fit a logistic model accoding to a boot.
Here 'glm_each_boot' is being called directly. However, it is typically called within another function using multiple boots, such as 'glm_each_subsample.'
```{r, results='hide'}
form = income ~ hours.per.week + age + gender
glm_each_boot(form, vignette_sample, nrow(vignette_sample))

```

# glm1
Use 'glm1' to fit a logistic model with prescribed frequencies.
Here 'glm1' is fitting a logistic model to the data, given the frequencies. 
Like 'glm_each_boot', glm1 is helpful when called within another function working with boots.
```{r}
freq <- rmultinom(1, nrow(vignette_sample), rep(1, nrow(vignette_sample)))
glm1(form, vignette_sample, freq)
```


# glm_each_subsample
Use 'glm_each_subsample' to fit a logistic model subsampling B times.
Again, 'glm_each_subsample' is most helpeful when called within another function.
In this library 'blbglm' calls 'glm_each_subsample.
```{r, results='hide', warning=FALSE}
glm_each_subsample(form, vignette_sample, nrow(df), B=100) 
```

# blbglm
'blbglm' is one of the more powerful functions in the library.
'blbglm' fits a logistic model using BLB with m boots and B resamples.
The fits returned may be passed to other function for further utility (as seen below).
```{r, results='hide'}
blbfit <- blbglm(form, vignette_sample, m = 3, B = 100)
```


# blbsigma
Use 'blbsigma' for the sigma of each model.
```{r}
blbsigma(lm(income~age, vignette_sample)) 
```


# blbcoef
Use 'blbcoef' for the coefficients of a model
```{r}
blbcoef(lm(income~age, vignette_sample))
```



# coef.blbglm
Pass a fitted model like one returned by 'blbglm' to 'coef.blbglm' for the model coefficients.
```{r}
coef.blbglm(blbfit)
```


# sigma.blbglm
Pass a fitted model like one returned by 'blbglm' to 'sigma.blbglm' for the model sigma value. Argument 'ci' set to TRUE returns a confidence interval for sigma.
```{r}
## NO CI
sigma.blbglm(blbfit,ci=FALSE) 

## With CI
sigma.blbglm(blbfit,ci=TRUE) 
```

# confint.blbglm
Pass a fitted model like one returned by 'blbglm' to 'confint.blbglm' for the model coefficients as 95% confidence intervals.
```{r}
confint.blbglm(blbfit)
```

# predict.blbglm
Pass a fitted model and test data  to 'predict.blbglm' to predict the binary outcome.
The returned values are probabilities the outcome is 1 or TRUE. Here a basic cutoff is assigned using round. 
```{r}
set.seed(142)
predictset <- df[sample(200) + 250,]

round(predict.blbglm(blbfit,predictset,confidence=FALSE))
```


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


